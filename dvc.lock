schema: '2.0'
stages:
  prepare:
    cmd: python mlops_imdb/data/prepare.py
    deps:
    - path: data/raw/imdb_test.csv
      hash: md5
      md5: 90b9367c418d3ca633671eef1d0aff5f
      size: 32565148
    - path: data/raw/imdb_train.csv
      hash: md5
      md5: 62acf68c544d136cc6675df497b6a01f
      size: 33347168
    - path: mlops_imdb/data/prepare.py
      hash: md5
      md5: c7ae6d44b8c6a9859a7673cafaf8aa62
      size: 3184
    params:
      params.yaml:
        data:
          raw:
            train: data/raw/imdb_train.csv
            test: data/raw/imdb_test.csv
          processed:
            train: data/processed/train_clean.csv
            test: data/processed/test_clean.csv
          split_info: data/split_info.json
          schema:
            text_col: text
            label_col: label
            label_domain:
            - 0
            - 1
          split:
            strategy: fixed_from_split_info
            train_ratio: 0.5
        preprocessing:
          lowercase: true
          remove_html_tags: true
          normalize_whitespace: true
        random_seed: 42
    outs:
    - path: data/processed/test_clean.csv
      hash: md5
      md5: c96b5d7197046d5d1c9b16fb9580c898
      size: 32005227
    - path: data/processed/train_clean.csv
      hash: md5
      md5: 1da332c8b46ee244eeaddd255532af0d
      size: 32776856
  features:
    cmd: python mlops_imdb/features/build_features.py
    deps:
    - path: data/processed/test_clean.csv
      hash: md5
      md5: c96b5d7197046d5d1c9b16fb9580c898
      size: 32005227
    - path: data/processed/train_clean.csv
      hash: md5
      md5: 1da332c8b46ee244eeaddd255532af0d
      size: 32776856
    - path: mlops_imdb/features/build_features.py
      hash: md5
      md5: 04914a97a59a5bf5496c4fdfde8ff1de
      size: 3318
    params:
      params.yaml:
        features:
          vectorizer: tfidf
          tfidf:
            max_features: 10000
            ngram_range:
            - 1
            - 2
            min_df: 2
            max_df: 0.95
          outputs:
            train_features: data/processed/train_features.npz
            test_features: data/processed/test_features.npz
            vectorizer_path: models/tfidf_vectorizer.pkl
    outs:
    - path: data/processed/test_features.npz
      hash: md5
      md5: 8a0a08db0632166181082603b9844dff
      size: 40230615
    - path: data/processed/train_features.npz
      hash: md5
      md5: ae88cce85c67648381cd756baf7b16a7
      size: 42017550
    - path: models/tfidf_vectorizer.pkl
      hash: md5
      md5: 8681d64262fc5208a3de0c2ede376075
      size: 377520
  train:
    cmd: python mlops_imdb/modeling/train.py
    deps:
    - path: data/processed/train_features.npz
      hash: md5
      md5: ae88cce85c67648381cd756baf7b16a7
      size: 42017550
    - path: mlops_imdb/modeling/train.py
      hash: md5
      md5: 09411faf0636dbe3754060d211693b78
      size: 3826
    params:
      params.yaml:
        train:
          model_type: logistic_regression
          logreg:
            max_iter: 1000
            random_state: 42
          outputs:
            model_path: models/model.pkl
    outs:
    - path: models/model.pkl
      hash: md5
      md5: 26dbaad453d8d263e68c3bb3ffb94a94
      size: 80891
  eval:
    cmd: python mlops_imdb/modeling/eval.py
    deps:
    - path: data/processed/test_features.npz
      hash: md5
      md5: 8a0a08db0632166181082603b9844dff
      size: 40230615
    - path: mlops_imdb/modeling/eval.py
      hash: md5
      md5: 4dea09ce7e88ba2177964e9b5b0fbd52
      size: 5561
    - path: models/model.pkl
      hash: md5
      md5: 26dbaad453d8d263e68c3bb3ffb94a94
      size: 80891
    params:
      params.yaml:
        eval:
          metrics:
          - accuracy
          - precision
          - recall
          - f1
          outputs:
            metrics_json: reports/metrics.json
            confusion_matrix_png: reports/figures/baseline_confusion_matrix.png
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: e4b25b07e37f6e9a57a7f52a099e1ce0
      size: 419
